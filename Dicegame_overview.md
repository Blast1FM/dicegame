# Описание архитектуры игры

## Мастер сервер

Организует создание и подключение игрока к лобби, а также доступ к лидерборду

Имеет 4 ресурса:
- GET /ActiveLobbies
- GET /Leaderboard
- POST /CreateLobby
- POST /JoinLobby

Лидерборд включает в себя игроков, отсортированных по количеству проигранных "денег" - лидерборд проигравших.

При создании лобби мастер сервер запускает экземпляр GameRoomController в отдельном процессе, представляющий собой сам игровой сервер.

При завершении игры результаты отправляются на мастер сервер для сохранения в БД.

Игровой сервер работает на базе машины состояний. В методе Enter и Exit состояние подписывается на события подключения/отключения клиентов, для дополнительной обработки, помимо логики, представленной в GameRoomController. В методе Update происходит логика хода игры.

Клиенты производят polling сервера на факт иземенения состояния игры. Если состояние сервера должно измениться, сервер ожидает StateStatusRequest от всех игроков, отправляет название следующего состояния в ответ на этот запрос, и изменяет состояние после того, как эти сообщения были отправлены всем клиентам.